<div class="space-y-6">
  <!-- Coupons List -->
  <div *ngIf="!selectedCoupon">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Available Coupons</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div
        *ngFor="let coupon of coupons"
        (click)="onCouponClick(coupon)"
        [class.cursor-pointer]="coupon.status === 'Active'"
        [class.cursor-not-allowed]="coupon.status !== 'Active'"
        [class.opacity-50]="coupon.status !== 'Active'"
        class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow duration-200">
        <div class="flex justify-between items-start mb-2">
          <h4 class="font-semibold text-gray-900">{{ coupon.couponCode }}</h4>
          <span [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getStatusBadgeClass(coupon.status)">
            {{ coupon.status }}
          </span>
        </div>
        <p class="text-sm text-gray-600 mb-2">{{ coupon.schemeName }}</p>
        <div class="space-y-1 text-sm text-gray-600">
          <p>Price: <span class="font-medium">${{ coupon.price }}</span></p>
          <p>Remaining Services: <span class="font-medium">{{ coupon.remainingServices }}/{{ coupon.totalServices }}</span></p>
          <p class="text-xs text-gray-500">Expires: {{ coupon.expiryDate | date:'short' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Products List -->
  <div *ngIf="selectedCoupon">
    <div class="flex items-center justify-between mb-4">
      <div>
        <button
          (click)="goBack()"
          class="text-blue-600 hover:text-blue-800 mb-2 flex items-center">
          <span class="material-icons mr-1">arrow_back</span>
          Back to Coupons
        </button>
        <h3 class="text-lg font-semibold text-gray-900">Products for {{ selectedCoupon.couponCode }}</h3>
      </div>
    </div>

    <div *ngIf="loadingProducts" class="text-center py-8">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-gray-600">Loading products...</p>
    </div>

    <div *ngIf="!loadingProducts && products.length === 0" class="text-center py-8">
      <p class="text-gray-600">No products available for this coupon</p>
    </div>

    <div *ngIf="!loadingProducts && products.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div
        *ngFor="let product of products"
        class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col">
        <div class="flex justify-between items-start mb-2">
          <h4 class="font-semibold text-gray-900">{{ product.productName }}</h4>
          <span *ngIf="product.isRedeemed" class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
            Redeemed
          </span>
        </div>
        <p class="text-sm text-gray-600 mb-4 flex-grow">{{ product.description }}</p>
        <div *ngIf="product.isRedeemed && product.redemptionDate" class="text-xs text-gray-500 mb-4">
          Redeemed on: {{ product.redemptionDate | date:'short' }}
        </div>
        <button
          (click)="!product.isRedeemed && onConfirmRedeem(product)"
          [disabled]="isRedeeming || product.isRedeemed"
          class="w-full px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed mt-auto"
          [ngClass]="{
            'text-white': !product.isRedeemed,
            'text-gray-500 bg-gray-100': product.isRedeemed
          }"
          [style.background-color]="!product.isRedeemed ? 'var(--button-primary-bg)' : 'transparent'"
          [style.cursor]="product.isRedeemed ? 'default' : 'pointer'"
          (mouseover)="onButtonHover($event, product.isRedeemed)"
          (mouseout)="onButtonHoverOut($event, product.isRedeemed)">
          {{ product.isRedeemed ? 'Redeemed' : 'Confirm Redeem' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <app-confirmation-dialog
    [show]="showConfirmationDialog"
    title="Confirm Redemption"
    message="Are you sure you want to redeem this product?"
    [productName]="selectedProduct?.productName"
    [productDescription]="selectedProduct?.description"
    confirmButtonText="Confirm Redeem"
    cancelButtonText="Cancel"
    (confirm)="onConfirmDialog()"
    (cancel)="onCancelDialog()">
  </app-confirmation-dialog>
</div>

