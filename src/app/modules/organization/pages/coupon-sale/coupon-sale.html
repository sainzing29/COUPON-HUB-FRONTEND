<div class="coupon-sale-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="flex items-center mb-6">
      <button 
        (click)="currentStep === 'otp' ? goBack() : goBackToOtp()"
        class="mr-4 p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors duration-200">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1 class="text-2xl font-bold text-gray-900">
        {{ currentStep === 'otp' ? 'Mobile Verification' : 'Sell Coupon' }}
      </h1>
    </div>
  </div>

  <!-- OTP Verification Section -->
  <div *ngIf="currentStep === 'otp'" class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-mobile-alt text-2xl text-blue-600"></i>
        </div>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">Mobile Verification</h2>
        <p class="text-gray-600">Please verify your mobile number to proceed with coupon sale</p>
      </div>

      <form [formGroup]="otpForm">
        <div class="space-y-6">
          <!-- Mobile Number Input -->
          <div *ngIf="!otpSent">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Mobile Number <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-mobile-alt text-gray-400"></i>
              </div>
              <input
                type="tel"
                formControlName="mobile"
                class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="Enter mobile number"
                [class.border-red-500]="otpMobileControl?.invalid && otpMobileControl?.touched">
            </div>
            <div *ngIf="otpMobileControl?.invalid && otpMobileControl?.touched" 
                 class="text-red-500 text-xs mt-1">
              <span *ngIf="otpMobileControl?.errors?.['required']">Mobile number is required</span>
              <span *ngIf="otpMobileControl?.errors?.['pattern']">Please enter a valid mobile number</span>
            </div>
          </div>

          <!-- OTP Input -->
          <div *ngIf="otpSent">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Enter OTP <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-key text-gray-400"></i>
              </div>
              <input
                type="text"
                formControlName="otp"
                class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg tracking-widest"
                placeholder="000000"
                maxlength="6"
                [class.border-red-500]="otpCodeControl?.invalid && otpCodeControl?.touched">
            </div>
            <div *ngIf="otpCodeControl?.invalid && otpCodeControl?.touched" 
                 class="text-red-500 text-xs mt-1">
              <span *ngIf="otpCodeControl?.errors?.['required']">OTP is required</span>
              <span *ngIf="otpCodeControl?.errors?.['pattern']">Please enter a valid 6-digit OTP</span>
            </div>
            <p class="text-sm text-gray-500 mt-2">
              OTP sent to {{ mobileNumber }}
            </p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex justify-between">
          <button
            *ngIf="otpSent"
            type="button"
            (click)="resendOtp()"
            class="px-4 py-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200 flex items-center space-x-2">
            <i class="fas fa-redo"></i>
            <span>Resend OTP</span>
          </button>
          
          <div class="ml-auto">
            <button
              *ngIf="!otpSent"
              type="button"
              (click)="sendOtp()"
              [disabled]="otpMobileControl?.invalid"
              class="px-6 py-3 bg-blue-600 text-white rounded-lg transition-colors duration-200 flex items-center space-x-2 font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
              <i class="fas fa-paper-plane"></i>
              <span>Send OTP</span>
            </button>
            
            <button
              *ngIf="otpSent"
              type="button"
              (click)="verifyOtp()"
              [disabled]="otpCodeControl?.invalid"
              class="px-6 py-3 bg-green-600 text-white rounded-lg transition-colors duration-200 flex items-center space-x-2 font-medium hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
              <i class="fas fa-check"></i>
              <span>Verify OTP</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Sale Form -->
  <div *ngIf="currentStep === 'sale'" class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <form [formGroup]="saleForm" (ngSubmit)="submitSale()">
        <div class="space-y-6">
          <!-- Sell Coupon Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Sell Coupon
            </label>
            <div class="relative">
              <div class="px-4 py-3 border border-gray-300 rounded-lg bg-gray-50">
                <span class="text-lg font-bold text-blue-600">{{ couponCode }}</span>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">Coupon code to be sold</p>
          </div>

          <!-- Customer Name Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Customer Name <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              formControlName="customerName"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Enter customer name"
              [class.border-red-500]="saleForm.get('customerName')?.invalid && saleForm.get('customerName')?.touched">
            <div *ngIf="saleForm.get('customerName')?.invalid && saleForm.get('customerName')?.touched" 
                 class="text-red-500 text-xs mt-1">
              Customer name is required
            </div>
          </div>

          <!-- Customer Email Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Customer Email <span class="text-red-500">*</span>
            </label>
            <input
              type="email"
              formControlName="customerEmail"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Enter customer email"
              [class.border-red-500]="saleForm.get('customerEmail')?.invalid && saleForm.get('customerEmail')?.touched">
            <div *ngIf="saleForm.get('customerEmail')?.invalid && saleForm.get('customerEmail')?.touched" 
                 class="text-red-500 text-xs mt-1">
              <span *ngIf="saleForm.get('customerEmail')?.errors?.['required']">Customer email is required</span>
              <span *ngIf="saleForm.get('customerEmail')?.errors?.['email']">Please enter a valid email address</span>
            </div>
          </div>

          <!-- Customer Mobile Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Customer Mobile <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-mobile-alt text-gray-400"></i>
              </div>
              <input
                type="tel"
                formControlName="mobile"
                [readonly]="true"
                class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed"
                placeholder="Mobile number from verification">
            </div>
            <p class="text-xs text-gray-500 mt-1">Mobile number verified from OTP step</p>
          </div>

          <!-- Amount Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Amount
            </label>
            <div class="relative">
              <input
                type="text"
                formControlName="amount"
                [disabled]="true"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed">
              <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                <span class="text-gray-500 text-sm font-medium">AED</span>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">Fixed amount for this coupon</p>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="mt-8 flex justify-end">
          <button
            type="submit"
            [disabled]="saleForm.invalid || isSubmitting"
            class="px-8 py-3 text-white disabled:cursor-not-allowed rounded-lg transition-colors duration-200 flex items-center space-x-2 font-medium"
            style="background-color: var(--button-primary-bg);"
            onmouseover="this.style.backgroundColor='var(--button-primary-hover)'"
            onmouseout="this.style.backgroundColor='var(--button-primary-bg)'"
            onfocus="this.style.backgroundColor='var(--button-primary-focus)'"
            onblur="this.style.backgroundColor='var(--button-primary-bg)'">
            <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
            <i *ngIf="!isSubmitting" class="fas fa-check"></i>
            <span>{{ isSubmitting ? 'Processing...' : 'Submit' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div 
    *ngIf="showToast" 
    class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300"
    [class.translate-x-0]="showToast"
    [class.translate-x-full]="!showToast">
    <div class="flex items-center space-x-2">
      <i class="fas fa-check-circle"></i>
      <span>Invoice generated successfully!</span>
    </div>
  </div>
</div>